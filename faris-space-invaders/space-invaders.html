<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Space Invaders</title>
</head>
<body>
<canvas id="game-canvas" width="800" height="800"></canvas>
<!-- <h1>R to refresh</h1> -->
<script>
    const canvas = document.querySelector('#game-canvas');
    const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

    let isMoving = false;
    let positionShipX = 790;
    let positionShipY = 800;
    let positionGun = 830;
    var deltaX = 0;
    var deltaY = 0;

    //bullet physics
    var bulletId = -1;
    var bullets = [];
    let bulletY = 750;

    // enemies
        var enemyId = 0;
        var enemies = [];

    function drawShip() {
        
        ctx.clearRect(0,770, canvas.width,canvas.height);

        //the moving fighter
        ctx.beginPath();
        //ship
        ctx.rect(positionShipX + deltaX,positionShipY,100,30);
        //gun
        ctx.rect(positionGun + deltaX,790,20,20);

        //triangle

        // ctx.moveTo(200 + deltaX, 100 + deltaY);
        // ctx.lineTo(170 + deltaX, 150 + deltaY);
        // ctx.lineTo(230 + deltaX ,150 + deltaY);

        ctx.closePath();
    
        ctx.lineWidth = 5;
        ctx.strokeStyle = "red";
        ctx.stroke();

        ctx.fillStyle = "rgba(255,204,0,1)";
        ctx.fill();
    
    }

    drawShip();

    function drawBadGuys() {
        


        while(enemyId < 20){
            enemies.push({
                x:100 * enemyId , y:20, w:30, h:20, id:enemyId
            })
            enemyId++
        }
        ctx.beginPath();
        for (i = 0; i < enemies.length; i++) { 
            ctx.rect(enemies[i].x ,20 + 10,enemies[i].w,enemies[i].h);
        }
        
        ctx.closePath();
    
        ctx.lineWidth = 5;
        ctx.strokeStyle = "green";
        ctx.stroke();

        ctx.fillStyle = "green";
        ctx.fill();
        
    
    }
    

    function shootBullet(x,y){
        ctx.fillStyle = "blue";
        ctx.fillRect(x,y,5,20);
        ctx.fill();
        bulletId += 1;
        bullets.push({
            x,
            y,
            w:5,
            h:20,
            id:bulletId
        });
        setInterval(function(){
            for(i=0;i < enemies.length; i++){
                if(enemies[i].x === x){
                    ctx.clearRect(enemies[i].x,enemies[i].y,enemies[i].w ,enemies[i].h);
                }
            };
            ctx.clearRect(x,y,5,20);
            y -= 50;
            ctx.fillRect(x,y,5,20);
            ctx.fill();
            bullets[bulletId].y = y;
        },1000);
        
}

drawBadGuys();
console.log(enemies);
    
    //movement

    function move(e) {
        var movementPositionX = positionShipX + deltaX;
        var movementPositionY = positionShipY + deltaY;
        var movementGun = positionGun + deltaX;
        // console.log(deltaX);

        if(e.keyCode === 37){
            if(movementPositionX < 30){
                deltaX = -760;
            };
            deltaX -= 20;
            console.log('moving left');
        }
        if(e.keyCode === 39){
            if(movementPositionX > 1570){
                deltaX = 760;
            };
            deltaX +=20;
            console.log('moving right');
        }

	    if(event.keyCode == 32){
            if(deltaX !== 0){
                shootBullet(movementGun +5, bulletY);
            }

            console.log('shooot!!!', movementGun, bulletY);
	    }


        //moving up and down

        // if(e.keyCode === 40){
        //     deltaY +=20;
        //     console.log('moving down')
        // }
        // if(e.keyCode === 38){
        //     deltaY -=20;
        //     console.log('moving up')
        // }
        
        //dev reload override
        if(e.code === "KeyR"){
                location.reload();
            };
        e.preventDefault();
        drawShip();
    };

    // if(bulletY <= enemies.y &&  movementGun === enemies.x){
    //     var
    // }


    window.addEventListener("keydown", move, false);


</script>

<style>
  html, body {
    margin:0;
  }
  canvas {
    /* padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    display: block;
    width: 1500px; */
  background: #111a22;
}

</style>

</body>
</html>