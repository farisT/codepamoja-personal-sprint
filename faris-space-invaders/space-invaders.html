<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Space Invaders</title>
</head>
<body>
<canvas id="game-canvas" width="800" height="800"></canvas>
<!-- <h1>R to refresh</h1> -->
<script>
    const canvas = document.querySelector('#game-canvas');
    const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

    let bulletMovement = null;

    //bullet physics
    var bulletId = -1;
    var bullets = [];

    var fighter = {
        x:790,
        y:800,
        deltaX:0,
        deltaY:0,
        positionGun:830
    }    

    

    // enemies
        var enemyId = 0;
        var enemies = [];

    function drawShip() {
        
        ctx.clearRect(0,770, canvas.width,canvas.height);

        //the moving fighter
        ctx.beginPath();
        //ship
        ctx.fillRect(fighter.x + fighter.deltaX,fighter.y,100,30);
        //gun
        ctx.fillRect(fighter.positionGun + fighter.deltaX,790,20,20);

        //triangle

        // ctx.moveTo(200 + fighter.deltaX, 100 + fighter.deltaY);
        // ctx.lineTo(170 + fighter.deltaX, 150 + fighter.deltaY);
        // ctx.lineTo(230 + fighter.deltaX ,150 + fighter.deltaY);

        // ctx.closePath();
    
        // ctx.lineWidth = 5;
        // ctx.strokeStyle = "red";
        // ctx.stroke();

        ctx.fillStyle = "rgba(255,204,0,1)";
        ctx.fill();
    
    }

    drawShip();

    function initialBadGuys() {
        


        while(enemyId < 15){
            enemies.push({
                x:200 + 90 * enemyId , y:20, w:30, h:20, id:enemyId
            })
            enemyId++
        }
        // ctx.beginPath();
        // for (i = 0; i < enemies.length; i++) { 
        //     ctx.rect(enemies[i].x ,enemies[i].y,enemies[i].w,enemies[i].h);
        // }
        // // ctx.closePath();
        // ctx.lineWidth = 5;
        // ctx.strokeStyle = "green";
        // // ctx.stroke();
        // ctx.fillStyle = "green";
        // ctx.fill();
        
    
    }
    initialBadGuys();

    function drawBadGuys() {
        for (i = 0; i < enemies.length; i++) { 
        ctx.fillRect(enemies[i].x ,enemies[i].y,30,20);
        ctx.fillStyle = "green";
        ctx.fill();
        }
    
    }
    

    function shootBullet(){
        for(var bullet=0; bullet < bullets.length; bullet = bullet +1){
            ctx.fillRect(bullets[bullet].x,bullets[bullet].y,5,20);
            ctx.fillStyle = "red";
            ctx.fill();
        }

        // bulletId += 1;
        // bullets.push({
        //     x,
        //     y,
        //     w:5,
        //     h:20,
        //     id:bulletId
        // });
        // if(!y){
        //     clearInterval(bulletMovement)
        // };
        // bulletMovement = setInterval(function(){
        //     ctx.clearRect(x,y,5,20);
        //     y -= 50;
        //     ctx.fillRect(x,y,5,20);
        //     ctx.fill();
        //     bullets[bulletId].y = y;
        // },1000);       
}

    function moveBullet() {
        for(var bullet=0; bullet < bullets.length; bullet = bullet +1){
            ctx.clearRect(bullets[bullet].x,bullets[bullet].y,5,20);
            bullets[bullet].y = bullets[bullet].y - 20;
        }
    }

    function moveEnemies(){
        console.log(enemies);
        for (var enemy = 0; enemy < enemies.length; enemy = enemy +1){
            ctx.clearRect(enemies[enemy].x, enemies[enemy].y,30,20);
            enemies[enemy].y = enemies[enemy].y + 5;
        }
    }



    //detection
    function collisionDetection() {
        for (var enemy = 0; enemy < enemies.length; enemy = enemy +1){
            for(var bullet = 0; bullet < bullets.length; bullet = bullet + 1){
                if(
                    (bullets[bullet].y <= enemies[enemy].y +30)&&
                    (bullets[bullet].x <= enemies[enemy].x +10)
                    
                ){
                    console.log('HIT!!!!');
                    ctx.clearRect(enemies[enemy].x,enemies[enemy].y,50,50); // clears the block
                    clearInterval(bulletMovement);
                    bullets.splice(bullet,1);
                    // enemies.splice(enemy,1);
                    
                    
                }
                

            }
        }

}
    //movement

    function move(e) {
        var movementPositionX = fighter.x + fighter.deltaX;
        var movementPositionY = fighter.y + fighter.deltaY;
        var movementGun = fighter.positionGun + fighter.deltaX;
        let bulletY = 750;

        if(e.keyCode === 37){
            if(movementPositionX < 30){
                fighter.deltaX = -760;
            };
            fighter.deltaX -= 20;
            console.log('moving left');
            drawShip();
        }
        if(e.keyCode === 39){
            if(movementPositionX > 1570){
                fighter.deltaX = 760;
            };
            fighter.deltaX +=20;
            console.log('moving right');
            drawShip(); 
        }

	    if(event.keyCode === 32){
            console.log(movementGun);
            if(fighter.deltaX !== 0){
            bulletId += 1;
            bullets.push({
            x:movementGun,
            y:bulletY,
            w:5,
            h:20,
            id:bulletId
        });
            shootBullet();
            }

	    }


        //To do: moving up and down (BONUS!!)

        // if(e.keyCode === 40){
        //     fighter.deltaY +=20;
        //     console.log('moving down')
        // }
        // if(e.keyCode === 38){
        //     fighter.deltaY -=20;
        //     console.log('moving up')
        // }
        
        //dev reload override
        if(e.code === "KeyR"){
                location.reload();
            };
        e.preventDefault();
        drawShip();
    };




    // if(bulletY <= enemies.y &&  movementGun === enemies.x){
    //     var
    // }


    window.addEventListener("keydown", move, false);
    // setInterval(collisionDetection,10);
    // window.addEventListener("keyup", collisionDetection, false);
function gameLoop(){
    setTimeout(gameLoop,100)
    moveBullet();

    shootBullet();
    moveEnemies();
    drawBadGuys();
}
gameLoop();
</script>

<style>
  html, body {
    margin:0;
  }
  canvas {
    /* padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    display: block;
    width: 1500px; */
  background: #111a22;
}

</style>

</body>
</html>